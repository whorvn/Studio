<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Organizer Dashboard | HackConnect</title>
    <meta
      name="description"
      content="Manage your hackathon events and create new challenges"
    />
    <link rel="stylesheet" href="../../styles.css" />
    <link rel="stylesheet" href="../../components/auth.css" />
    <link rel="stylesheet" href="../../components/organizer.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* Admin background styling */
      .main-content {
        background: linear-gradient(
          135deg,
          rgba(46, 59, 85, 0.03),
          rgba(103, 116, 142, 0.05)
        );
        position: relative;
      }

      .main-content::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-image: url("../../assets/images/pattern.svg");
        background-size: 500px;
        opacity: 0.02;
        pointer-events: none;
        z-index: 0;
      }

      .content-header,
      .welcome-card,
      .dashboard-grid,
      .event-list {
        position: relative;
        z-index: 1;
      }

      /* Dashboard card enhancements */
      .dashboard-card {
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.04), 0 1px 3px rgba(0, 0, 0, 0.08);
        background: linear-gradient(to bottom, #ffffff, #fafbff);
        border: 1px solid rgba(225, 230, 245, 0.8);
      }

      .card-icon {
        background: linear-gradient(
          135deg,
          rgba(79, 70, 229, 0.1),
          rgba(79, 70, 229, 0.15)
        );
      }

      .welcome-card {
        border: 1px solid rgba(225, 230, 245, 0.8);
      }
    </style>
  </head>
  <body>
    <div class="dashboard-layout">
      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <a href="dashboard.html" class="logo">
            <i class="fas fa-code"></i>
            <span>HackConnect</span>
          </a>
        </div>

        <nav class="sidebar-menu">
          <div class="menu-title">MAIN</div>
          <a href="dashboard.html" class="menu-item active">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
          </a>
          <a href="create-event.html" class="menu-item">
            <i class="fas fa-plus-circle"></i>
            <span>Create Hackathon</span>
          </a>
          <a href="participants.html" class="menu-item">
            <i class="fas fa-users"></i>
            <span>Participants</span>
          </a>
          <a href="mentors.html" class="menu-item">
            <i class="fas fa-user-tie"></i>
            <span>Mentors</span>
          </a>
          <a href="#" class="menu-item">
            <i class="fas fa-trophy"></i>
            <span>Submissions</span>
          </a>

          <div class="menu-title">SETTINGS</div>
          <a href="#" class="menu-item">
            <i class="fas fa-cog"></i>
            <span>Account Settings</span>
          </a>
          <a href="#" class="menu-item">
            <i class="fas fa-building"></i>
            <span>Organization Profile</span>
          </a>
          <a href="#" class="menu-item">
            <i class="fas fa-users-cog"></i>
            <span>Team Members</span>
          </a>
          <a href="#" class="menu-item" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </nav>
      </aside>

      <!-- Main Content Area -->
      <div class="main-content">
        <div class="content-header">
          <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
          </button>

          <div class="content-title">
            <h1>Organizer Dashboard</h1>
            <div class="content-subtitle">Welcome back, Organization Admin</div>
          </div>

          <div class="header-actions">
            <a href="create-event.html" class="btn btn--primary">
              <i class="fas fa-plus"></i>
              Create Hackathon
            </a>
          </div>
        </div>

        <!-- Welcome Card -->
        <div class="welcome-card">
          <div class="welcome-content">
            <h2 class="welcome-title">
              Welcome to the Allin Platform – Organiser Portal
            </h2>
            <p class="welcome-text">
              Manage all aspects of your hackathon events, from creation to
              execution. Create engaging challenges, recruit judges and mentors,
              and showcase innovation.
            </p>
            <a href="create-event.html" class="btn btn--primary">
              <i class="fas fa-plus"></i>
              Create New Hackathon
            </a>
          </div>
        </div>

        <!-- Dashboard Stats -->
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <div class="card-header">
              <div class="card-icon">
                <i class="fas fa-calendar-check"></i>
              </div>
              <button class="card-menu">
                <i class="fas fa-ellipsis-v"></i>
              </button>
            </div>
            <div class="card-title">Active Events</div>
            <div class="card-value" id="active-events-count">0</div>
            <div class="card-meta">
              <span>No events in progress</span>
            </div>
          </div>

          <div class="dashboard-card">
            <div class="card-header">
              <div class="card-icon">
                <i class="fas fa-user-check"></i>
              </div>
              <button class="card-menu">
                <i class="fas fa-ellipsis-v"></i>
              </button>
            </div>
            <div class="card-title">Participants</div>
            <div class="card-value" id="participants-count">0</div>
            <div class="card-meta">
              <span>Across all events</span>
            </div>
          </div>

          <div class="dashboard-card">
            <div class="card-header">
              <div class="card-icon">
                <i class="fas fa-code-branch"></i>
              </div>
              <button class="card-menu">
                <i class="fas fa-ellipsis-v"></i>
              </button>
            </div>
            <div class="card-title">Submissions</div>
            <div class="card-value" id="submissions-count">0</div>
            <div class="card-meta">
              <span>Across all events</span>
            </div>
          </div>

          <div class="dashboard-card">
            <div class="card-header">
              <div class="card-icon">
                <i class="fas fa-user-tie"></i>
              </div>
              <button class="card-menu">
                <i class="fas fa-ellipsis-v"></i>
              </button>
            </div>
            <div class="card-title">Mentors</div>
            <div class="card-value" id="mentors-count">0</div>
            <div class="card-meta">
              <span>Available to help</span>
            </div>
          </div>
        </div>

        <!-- Event List -->
        <div class="event-list">
          <div class="event-list-header">
            <div class="event-list-title">Your Hackathons</div>
            <div class="event-list-tabs">
              <div class="event-tab active">All</div>
              <div class="event-tab">Draft</div>
              <div class="event-tab">Scheduled</div>
              <div class="event-tab">In Progress</div>
              <div class="event-tab">Completed</div>
            </div>
          </div>
          <div class="event-list-body">
            <div
              id="no-events-message"
              style="padding: 2rem; text-align: center; display:none;"
            >
              <i
                class="fas fa-calendar-plus"
                style="
                  font-size: 2.5rem;
                  color: var(--color-gray-300);
                  margin-bottom: 1rem;
                "
              ></i>
              <h3 style="margin-bottom: 0.5rem; color: var(--color-gray-700)">
                No hackathons yet
              </h3>
              <p style="color: var(--color-gray-500); margin-bottom: 1.5rem">
                Start creating your first hackathon experience.
              </p>
              <a href="create-event.html" class="btn btn--primary"
                >Create Your First Hackathon</a
              >
            </div>
            <div id="hackathon-list"></div>
          </div>
          <div class="event-list-footer">
            <a href="create-event.html" class="btn btn--outline"
              >Create New Hackathon</a
            >
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Check if we have a hackathon created from preview
        const hasCreatedHackathon = localStorage.getItem("created_hackathon");
        if (hasCreatedHackathon) {
          // Show sample events and hide empty state
          document.getElementById("no-events-message").style.display = "none";
          document.getElementById("sample-events").style.display = "block";

          // Add the new hackathon to the top of the list
          const hackathonData = JSON.parse(hasCreatedHackathon);
          addNewHackathon(hackathonData);
        }

        // Mobile sidebar toggle
        const menuToggle = document.getElementById("menuToggle");
        const sidebar = document.querySelector(".sidebar");

        if (menuToggle && sidebar) {
          menuToggle.addEventListener("click", function () {
            sidebar.classList.toggle("show");
          });
        }

        // Event tabs functionality
        const eventTabs = document.querySelectorAll(".event-tab");

        eventTabs.forEach((tab) => {
          tab.addEventListener("click", function () {
            eventTabs.forEach((t) => t.classList.remove("active"));
            this.classList.add("active");

            // In a real application, you would filter events here
            // For this demo, we just show the message that there are no events
          });
        });

        // Sample dropdown menu functionality
        const cardMenus = document.querySelectorAll(".card-menu");

        cardMenus.forEach((menu) => {
          menu.addEventListener("click", function (e) {
            e.stopPropagation();
            // In a real application, you would show a dropdown menu here
            alert(
              "Card menu clicked. You can add dropdown functionality here."
            );
          });
        });

        // LOGOUT: accessToken ve refreshToken sil, signout yap
        const logoutBtn = document.getElementById("logoutBtn");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", function (e) {
            e.preventDefault();
            localStorage.removeItem("accessToken");
            localStorage.removeItem("refreshToken");
            window.location.href = "login.html";
          });
        }

        // Dashboard statistics API call
        const accessToken = localStorage.getItem("accessToken");
        if (accessToken) {
          fetch("http://142.93.173.189:5533/api/dashboard/statistics", {
            headers: {
              Authorization: "Bearer " + accessToken,
            },
          })
            .then((res) => res.json())
            .then((data) => {
              // API'den dönen veri: { status, msg, data: { ...istatistikler } }
              if (data && data.data) {
                document.getElementById("active-events-count").textContent =
                  data.data.active_events_count ?? 0;
                document.getElementById("participants-count").textContent =
                  data.data.participants_count ?? 0;
                document.getElementById("submissions-count").textContent =
                  data.data.submissions_count ?? 0;
                document.getElementById("mentors-count").textContent =
                  data.data.mentor_count ?? 0;
              }
              console.log("Dashboard statistics:", data);
            })
            .catch((err) => {
              console.log("Dashboard statistics error:", err);
            });
        } else {
          console.log("No access token found in localStorage.");
        }
      });

      // Function to add a new hackathon to the list
      function addNewHackathon(hackathonData) {
        const eventsContainer = document.getElementById("sample-events");
        const newEvent = document.createElement("div");
        newEvent.className = "event-item";
        newEvent.innerHTML = `
                <div class="event-logo">
                    ${
                      hackathonData.logo
                        ? `<img src="${hackathonData.logo}" alt="Hackathon logo">`
                        : `<i class="fas fa-laptop-code"></i>`
                    }
                </div>
                <div class="event-details">
                    <div class="event-name">${hackathonData.title}</div>
                    <div class="event-date">Draft • Created ${new Date().toLocaleDateString()}</div>
                </div>
                <div class="event-status status-draft">DRAFT</div>
                <div class="event-actions">
                    <a href="hackathon-preview.html" class="btn-icon">
                        <i class="fas fa-eye"></i>
                    </a>
                    <button class="btn-icon">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-icon">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

        // Insert at the beginning of the container
        if (eventsContainer.firstChild) {
          eventsContainer.insertBefore(newEvent, eventsContainer.firstChild);
        } else {
          eventsContainer.appendChild(newEvent);
        }

        // Add click handlers for the buttons
        const viewButton =
          newEvent.querySelector(".btn-icon i.fa-eye").parentElement;
        viewButton.addEventListener("click", function (e) {
          e.preventDefault();
          window.location.href = "hackathon-preview.html";
        });

        const deleteButton = newEvent.querySelector(
          ".btn-icon i.fa-trash"
        ).parentElement;
        deleteButton.addEventListener("click", function () {
          if (confirm("Are you sure you want to delete this hackathon?")) {
            localStorage.removeItem("created_hackathon");
            eventsContainer.removeChild(newEvent);

            // If no events left, show the empty state
            if (eventsContainer.children.length === 0) {
              document.getElementById("no-events-message").style.display =
                "block";
              document.getElementById("sample-events").style.display = "none";
            }
          }
        });
      }

      console.log("accessToken:", localStorage.getItem("accessToken"));

      // New script for fetching and displaying hackathons
      document.addEventListener("DOMContentLoaded", function () {
        const API_BASE = "http://142.93.173.189:5533";
        const accessToken = localStorage.getItem("accessToken");
        const hackathonList = document.getElementById("hackathon-list");
        const noEventsMsg = document.getElementById("no-events-message");

        async function fetchHackathons() {
          hackathonList.innerHTML = `<div style="text-align:center;color:#aaa;">Loading...</div>`;
          try {
            const res = await fetch(`${API_BASE}/api/hackathon`, {
              headers: { Authorization: "Bearer " + accessToken },
            });
            const data = await res.json();
            if (
              data &&
              data.data &&
              Array.isArray(data.data.hackathons) &&
              data.data.hackathons.length > 0
            ) {
              noEventsMsg.style.display = "none";
              hackathonList.innerHTML = "";
              data.data.hackathons.forEach((hackathon) => {
                const div = document.createElement("div");
                div.className = "event-item";
                div.innerHTML = `
                  <div class="event-logo">
                    <i class="fas fa-laptop-code"></i>
                  </div>
                  <div class="event-details">
                    <div class="event-name">${hackathon.name}</div>
                    <div class="event-date">${
                      hackathon.status
                        ? hackathon.status.toUpperCase()
                        : ""
                    } • ${
                  hackathon.updated_at
                    ? new Date(hackathon.updated_at).toLocaleDateString()
                    : ""
                }</div>
                    <div class="event-id" style="font-size:0.95em;color:#888;">ID: ${hackathon.id}</div>
                  </div>
                  <div class="event-status status-${
                    hackathon.status || "draft"
                  }">${hackathon.status ? hackathon.status.toUpperCase() : "DRAFT"
                }</div>
                  <div class="event-actions">
                    <a href="hackathon-preview.html?id=${hackathon.id}" class="btn-icon" title="Preview">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a href="edit-hackathon.html?id=${hackathon.id}" class="btn-icon" title="Edit">
                      <i class="fas fa-edit"></i>
                    </a>
                  </div>
                `;
                hackathonList.appendChild(div);
              });
            } else {
              hackathonList.innerHTML = "";
              noEventsMsg.style.display = "block";
            }
          } catch {
            hackathonList.innerHTML = `<div style="text-align:center;color:#ef4444;">Failed to load hackathons.</div>`;
            noEventsMsg.style.display = "none";
          }
        }

        fetchHackathons();
      });
    </script>
  </body>
</html>
